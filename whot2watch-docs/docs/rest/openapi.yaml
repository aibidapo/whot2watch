openapi: 3.0.3
info:
  title: Whot2Watch REST API (Fallback)
  version: '0.1.0'
  description: |
    MVP REST fallback for Whot2Watch providing parity with GraphQL for common read operations.
servers:
  - url: https://api.whot2watch.example.com/v1
tags:
  - name: Picks
    description: Daily recommendations and related operations
  - name: Search
    description: Title search endpoints
  - name: Availability
    description: Availability lookup across services and regions
  - name: Lists
    description: User lists and items
  - name: Alerts
    description: Alert configuration and management
  - name: Subscriptions
    description: Streaming service subscriptions for profiles
  - name: Feedback
    description: Title feedback (like, dislike, save)
  - name: Social
    description: Friends management, activity feed, and friends' picks
  - name: GroupSessions
    description: Group watch sessions
paths:
  /picks/{profileId}:
    get:
      operationId: getPicks
      tags: [Picks]
      description: Return curated or algorithmic daily picks for the given profile.
      summary: Get daily picks for a profile
      parameters:
        - in: path
          name: profileId
          schema: { type: string, format: uuid }
          required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: string, format: uuid }
                        name: { type: string }
                        type: { type: string, enum: [MOVIE, SHOW] }
                        releaseYear: { type: integer }
                        reason: { type: string }
                required: [items]
  /search:
    get:
      operationId: searchTitles
      tags: [Search]
      description: Search titles with optional region, providers, and runtime filters.
      summary: Search titles
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: service
          schema:
            type: array
            items: { $ref: '#/components/schemas/Provider' }
          style: form
          explode: false
        - in: query
          name: region
          schema:
            type: array
            items: { $ref: '#/components/schemas/Region' }
          style: form
          explode: false
        - in: query
          name: type
          schema:
            type: array
            items: { type: string, enum: [MOVIE, SHOW] }
          style: form
          explode: false
        - in: query
          name: yearMin
          schema: { type: integer }
        - in: query
          name: yearMax
          schema: { type: integer }
        - in: query
          name: runtimeMin
          schema: { type: integer }
        - in: query
          name: runtimeMax
          schema: { type: integer }
        - in: query
          name: size
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: from
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/Title' }
                  total: { type: integer }
                  took: { type: integer }
                  from: { type: integer }
                  size: { type: integer }
                required: [items, total, from, size]
  /availability/{titleId}:
    get:
      operationId: getAvailability
      tags: [Availability]
      description: Get availability for a title in a region and services.
      summary: Get availability for a title
      parameters:
        - in: path
          name: titleId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: region
          schema: { $ref: '#/components/schemas/Region' }
        - in: query
          name: services
          schema:
            type: array
            items: { $ref: '#/components/schemas/Provider' }
          style: form
          explode: false
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Availability' }
  /profiles/{profileId}/lists:
    get:
      operationId: listLists
      tags: [Lists]
      description: List user-created lists for a profile.
      summary: List user lists
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/List' }
                required: [items]
    post:
      operationId: createList
      tags: [Lists]
      summary: Create a list for a profile
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name: { type: string }
                visibility: { type: string, enum: [PRIVATE, FRIENDS, PUBLIC, COLLAB] }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: { list: { $ref: '#/components/schemas/List' } }
                required: [list]
  /lists/{listId}/items:
    post:
      operationId: addListItem
      tags: [Lists]
      summary: Add a title to a list (idempotent)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: listId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [titleId]
              properties:
                titleId: { type: string, format: uuid }
                position: { type: integer }
                note: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  item: { type: object }
                  idempotent: { type: boolean }
                required: [item]
  /lists/{listId}/items/{itemId}:
    delete:
      operationId: removeListItem
      tags: [Lists]
      summary: Remove a title from a list
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: listId
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: itemId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: { ok: { type: boolean } }
                required: [ok]
  /profiles/{profileId}/alerts:
    get:
      operationId: listAlerts
      tags: [Alerts]
      summary: List alerts for a profile
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/Alert' } }
                required: [items]
    post:
      operationId: createAlert
      tags: [Alerts]
      summary: Create an availability alert
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                titleId: { type: string, format: uuid }
                services: { type: array, items: { $ref: '#/components/schemas/Provider' } }
                region: { $ref: '#/components/schemas/Region' }
              anyOf:
                - required: [titleId]
                - required: [services]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: { alert: { $ref: '#/components/schemas/Alert' } }
                required: [alert]
  /profiles/{profileId}/subscriptions:
    get:
      operationId: listSubscriptions
      tags: [Subscriptions]
      summary: List active subscriptions for a profile
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/Subscription' } }
                required: [items]
    post:
      operationId: upsertSubscription
      tags: [Subscriptions]
      summary: Upsert a subscription for a profile
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [service]
              properties:
                service: { $ref: '#/components/schemas/Provider' }
                region: { $ref: '#/components/schemas/Region' }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: { subscription: { $ref: '#/components/schemas/Subscription' } }
                required: [subscription]
    delete:
      operationId: deleteSubscription
      tags: [Subscriptions]
      summary: Deactivate a subscription for a profile
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [service]
              properties:
                service: { $ref: '#/components/schemas/Provider' }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties: { ok: { type: boolean } }
                required: [ok]
  /feedback:
    post:
      operationId: postFeedback
      tags: [Feedback]
      summary: Send feedback for a title
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [profileId, titleId, action]
              properties:
                profileId: { type: string, format: uuid }
                titleId: { type: string, format: uuid }
                action: { type: string, enum: [LIKE, DISLIKE, SAVE] }
                reasonOpt: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                anyOf:
                  - type: object
                    properties: { suppressed: { type: boolean } }
                    required: [suppressed]
                  - type: object
                    properties: { feedback: { $ref: '#/components/schemas/Feedback' } }
                    required: [feedback]
  /profiles/{profileId}/friends:
    post:
      operationId: sendFriendRequest
      tags: [Social]
      summary: Send a friend request
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [toProfileId]
              properties:
                toProfileId: { type: string, format: uuid }
      responses:
        '200':
          description: Friend request sent
          content:
            application/json:
              schema:
                type: object
                properties: { friend: { $ref: '#/components/schemas/Friend' } }
                required: [friend]
        '409':
          description: Relationship already exists
          content:
            application/json:
              schema:
                type: object
                properties: { error: { type: string } }
    get:
      operationId: listFriends
      tags: [Social]
      summary: List friends for a profile
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: status
          schema: { type: string, enum: [REQUESTED, ACCEPTED] }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/FriendWithProfile' } }
                required: [items]
  /friends/{friendId}:
    patch:
      operationId: respondFriendRequest
      tags: [Social]
      summary: Accept or reject a friend request
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: friendId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [accept]
              properties:
                accept: { type: boolean }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                anyOf:
                  - type: object
                    properties: { friend: { $ref: '#/components/schemas/Friend' } }
                    required: [friend]
                  - type: object
                    properties: { ok: { type: boolean } }
                    required: [ok]
  /social/feed/{profileId}:
    get:
      operationId: getSocialFeed
      tags: [Social]
      summary: Activity feed of friends' recent likes and saves
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: limit
          schema: { type: integer, default: 20, maximum: 50 }
        - in: query
          name: before
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/FeedItem' } }
                required: [items]
        '503':
          description: Social features disabled
  /social/friends-picks/{profileId}:
    get:
      operationId: getFriendsPicks
      tags: [Social]
      summary: Titles popular among friends in the last N days
      parameters:
        - in: path
          name: profileId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: days
          schema: { type: integer, default: 14, maximum: 30 }
        - in: query
          name: limit
          schema: { type: integer, default: 10, maximum: 30 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/FriendsPickItem' } }
                required: [items]
        '503':
          description: Social features disabled
  /group-sessions:
    get:
      operationId: listGroupSessions
      tags: [GroupSessions]
      description: List group sessions filtered by host, participant, or status.
      summary: List group sessions
      parameters:
        - in: query
          name: hostProfileId
          schema: { type: string, format: uuid }
        - in: query
          name: participantProfileId
          schema: { type: string, format: uuid }
        - in: query
          name: status
          schema: { type: string, enum: [open, locked, closed] }
        - in: query
          name: first
          schema: { type: integer, default: 20 }
        - in: query
          name: after
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/GroupSession' } }
                  nextCursor: { type: string }
components:
  schemas:
    Region:
      type: string
      enum: [US, CA, GB, AU, IN]
    Provider:
      type: string
      enum:
        [
          NETFLIX,
          AMAZON_PRIME_VIDEO,
          DISNEY_PLUS,
          HULU,
          MAX,
          APPLE_TV_PLUS,
          PARAMOUNT_PLUS,
          PEACOCK,
          CRUNCHYROLL,
          TUBI,
          YOUTUBE,
          OTHER,
        ]
    Availability:
      type: object
      properties:
        service: { $ref: '#/components/schemas/Provider' }
        region: { $ref: '#/components/schemas/Region' }
        offerType: { type: string, enum: [SUBSCRIPTION, RENT, BUY, FREE] }
        deepLink: { type: string }
        lastSeenAt: { type: string, format: date-time }
    Title:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        type: { type: string, enum: [MOVIE, SHOW] }
        releaseYear: { type: integer }
        runtimeMin: { type: integer }
        genres: { type: array, items: { type: string } }
        moods: { type: array, items: { type: string } }
        posterUrl: { type: string }
        backdropUrl: { type: string }
        overview: { type: string }
        voteAverage: { type: number }
        popularity: { type: number }
        availability:
          type: array
          items: { $ref: '#/components/schemas/Availability' }
    Recommendation:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { $ref: '#/components/schemas/Title' }
        score: { type: number }
        reason: { type: string }
        createdAt: { type: string, format: date-time }
    Subscription:
      type: object
      properties:
        id: { type: string, format: uuid }
        service: { $ref: '#/components/schemas/Provider' }
        region: { $ref: '#/components/schemas/Region' }
        active: { type: boolean }
        createdAt: { type: string, format: date-time }
    List:
      type: object
      properties:
        id: { type: string, format: uuid }
        profileId: { type: string, format: uuid }
        name: { type: string }
        visibility: { type: string, enum: [PRIVATE, FRIENDS, PUBLIC, COLLAB] }
        description: { type: string }
        createdAt: { type: string, format: date-time }
    ListItem:
      type: object
      properties:
        id: { type: string, format: uuid }
        listId: { type: string, format: uuid }
        titleId: { type: string, format: uuid }
        position: { type: integer }
        note: { type: string }
        addedAt: { type: string, format: date-time }
    GroupSession:
      type: object
      properties:
        id: { type: string, format: uuid }
        hostProfileId: { type: string, format: uuid }
        name: { type: string }
        constraints: { type: object }
        status: { type: string, enum: [open, locked, closed] }
        createdAt: { type: string, format: date-time }
    Alert:
      type: object
      properties:
        id: { type: string, format: uuid }
        profileId: { type: string, format: uuid }
        titleId: { type: string, format: uuid }
        alertType: { type: string, enum: [AVAILABILITY] }
        services: { type: array, items: { $ref: '#/components/schemas/Provider' } }
        region: { $ref: '#/components/schemas/Region' }
        status: { type: string, enum: [ACTIVE, FIRED, CANCELLED] }
        createdAt: { type: string, format: date-time }
    Feedback:
      type: object
      properties:
        id: { type: string, format: uuid }
        profileId: { type: string, format: uuid }
        titleId: { type: string, format: uuid }
        action: { type: string, enum: [LIKE, DISLIKE, SAVE] }
        reasonOpt: { type: string }
        ts: { type: string, format: date-time }
    Friend:
      type: object
      properties:
        id: { type: string, format: uuid }
        fromProfileId: { type: string, format: uuid }
        toProfileId: { type: string, format: uuid }
        status: { type: string, enum: [REQUESTED, ACCEPTED] }
        createdAt: { type: string, format: date-time }
    FriendWithProfile:
      type: object
      properties:
        id: { type: string, format: uuid }
        profileId: { type: string, format: uuid }
        name: { type: string }
        avatarUrl: { type: string }
        status: { type: string, enum: [REQUESTED, ACCEPTED] }
        createdAt: { type: string, format: date-time }
    FeedItem:
      type: object
      properties:
        id: { type: string, format: uuid }
        profileId: { type: string, format: uuid }
        profileName: { type: string }
        profileAvatarUrl: { type: string }
        action: { type: string, enum: [LIKE, SAVE] }
        title:
          type: object
          properties:
            id: { type: string, format: uuid }
            name: { type: string }
            type: { type: string, enum: [MOVIE, SHOW] }
            releaseYear: { type: integer }
            posterUrl: { type: string }
            voteAverage: { type: number }
        ts: { type: string, format: date-time }
    FriendsPickItem:
      type: object
      properties:
        title:
          type: object
          properties:
            id: { type: string, format: uuid }
            name: { type: string }
            type: { type: string, enum: [MOVIE, SHOW] }
            releaseYear: { type: integer }
            posterUrl: { type: string }
            voteAverage: { type: number }
        friendCount: { type: integer }
        friendNames: { type: array, items: { type: string } }
        latestTs: { type: string, format: date-time }
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

