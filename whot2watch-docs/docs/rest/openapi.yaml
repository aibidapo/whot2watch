openapi: 3.0.3
info:
  title: Whot2Watch REST API (Fallback)
  version: '0.1.0'
  description: |
    MVP REST fallback for Whot2Watch providing parity with GraphQL for common read operations.
servers:
  - url: https://api.whot2watch.example.com/v1
tags:
  - name: Picks
    description: Daily recommendations and related operations
  - name: Search
    description: Title search endpoints
  - name: Availability
    description: Availability lookup across services and regions
  - name: Lists
    description: User lists and items
  - name: Alerts
    description: Alert configuration and management
  - name: Subscriptions
    description: Streaming service subscriptions for profiles
  - name: GroupSessions
    description: Group watch sessions
paths:
  /picks:
    get:
      operationId: getPicks
      tags: [Picks]
      description: Return curated or algorithmic daily picks for the given profile.
      summary: Get daily picks for a profile
      parameters:
        - in: query
          name: profileId
          schema: { type: string, format: uuid }
          required: true
        - in: query
          name: limit
          schema: { type: integer, default: 5, minimum: 1, maximum: 10 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Recommendation'
  /search:
    get:
      operationId: searchTitles
      tags: [Search]
      description: Search titles with optional region, providers, and runtime filters.
      summary: Search titles
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: region
          schema: { $ref: '#/components/schemas/Region' }
        - in: query
          name: providerIn
          schema:
            type: array
            items: { $ref: '#/components/schemas/Provider' }
          style: form
          explode: false
        - in: query
          name: runtimeLt
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/Title' }
                  nextCursor:
                    type: string
  /availability/{titleId}:
    get:
      operationId: getAvailability
      tags: [Availability]
      description: Get availability for a title in a region and services.
      summary: Get availability for a title
      parameters:
        - in: path
          name: titleId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: region
          schema: { $ref: '#/components/schemas/Region' }
        - in: query
          name: services
          schema:
            type: array
            items: { $ref: '#/components/schemas/Provider' }
          style: form
          explode: false
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Availability' }
  /lists:
    get:
      operationId: listLists
      tags: [Lists]
      description: List user-created lists for a profile with optional visibility filter.
      summary: List user lists
      parameters:
        - in: query
          name: profileId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: visibility
          schema: { type: string, enum: [PRIVATE, FRIENDS, PUBLIC, COLLAB] }
        - in: query
          name: first
          schema: { type: integer, default: 20 }
        - in: query
          name: after
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items: { $ref: '#/components/schemas/List' }
                  nextCursor: { type: string }
  /alerts:
    get:
      operationId: listAlerts
      tags: [Alerts]
      description: List alerts configured by a profile with optional status filter.
      summary: List alerts
      parameters:
        - in: query
          name: profileId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: status
          schema: { type: string, enum: [ACTIVE, FIRED, CANCELLED] }
        - in: query
          name: first
          schema: { type: integer, default: 20 }
        - in: query
          name: after
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { type: object } }
                  nextCursor: { type: string }
  /subscriptions:
    get:
      operationId: listSubscriptions
      tags: [Subscriptions]
      description: List active subscriptions for a profile.
      summary: List subscriptions
      parameters:
        - in: query
          name: profileId
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Subscription' }
  /group-sessions:
    get:
      operationId: listGroupSessions
      tags: [GroupSessions]
      description: List group sessions filtered by host, participant, or status.
      summary: List group sessions
      parameters:
        - in: query
          name: hostProfileId
          schema: { type: string, format: uuid }
        - in: query
          name: participantProfileId
          schema: { type: string, format: uuid }
        - in: query
          name: status
          schema: { type: string, enum: [open, locked, closed] }
        - in: query
          name: first
          schema: { type: integer, default: 20 }
        - in: query
          name: after
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items: { type: array, items: { $ref: '#/components/schemas/GroupSession' } }
                  nextCursor: { type: string }
components:
  schemas:
    Region:
      type: string
      enum: [US, CA, GB, AU, IN]
    Provider:
      type: string
      enum:
        [
          NETFLIX,
          AMAZON_PRIME_VIDEO,
          DISNEY_PLUS,
          HULU,
          MAX,
          APPLE_TV_PLUS,
          PARAMOUNT_PLUS,
          PEACOCK,
          CRUNCHYROLL,
          TUBI,
          OTHER,
        ]
    Availability:
      type: object
      properties:
        service: { $ref: '#/components/schemas/Provider' }
        region: { $ref: '#/components/schemas/Region' }
        offerType: { type: string, enum: [SUBSCRIPTION, RENT, BUY, FREE] }
        deepLink: { type: string }
        lastSeenAt: { type: string, format: date-time }
    Title:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        type: { type: string, enum: [MOVIE, SHOW] }
        releaseYear: { type: integer }
        runtimeMin: { type: integer }
        genres: { type: array, items: { type: string } }
        moods: { type: array, items: { type: string } }
        posterUrl: { type: string }
        backdropUrl: { type: string }
        overview: { type: string }
        voteAverage: { type: number }
        popularity: { type: number }
        availability:
          type: array
          items: { $ref: '#/components/schemas/Availability' }
    Recommendation:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { $ref: '#/components/schemas/Title' }
        score: { type: number }
        reason: { type: string }
        createdAt: { type: string, format: date-time }
    Subscription:
      type: object
      properties:
        id: { type: string, format: uuid }
        service: { $ref: '#/components/schemas/Provider' }
        region: { $ref: '#/components/schemas/Region' }
        active: { type: boolean }
        createdAt: { type: string, format: date-time }
    List:
      type: object
      properties:
        id: { type: string, format: uuid }
        ownerProfileId: { type: string, format: uuid }
        name: { type: string }
        visibility: { type: string, enum: [PRIVATE, FRIENDS, PUBLIC, COLLAB] }
        description: { type: string }
        createdAt: { type: string, format: date-time }
    GroupSession:
      type: object
      properties:
        id: { type: string, format: uuid }
        hostProfileId: { type: string, format: uuid }
        name: { type: string }
        constraints: { type: object }
        status: { type: string, enum: [open, locked, closed] }
        createdAt: { type: string, format: date-time }
